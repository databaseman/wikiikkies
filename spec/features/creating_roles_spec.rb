require "rails_helper"
RSpec.feature "Create new role" do

  before do
    visit "/roles"
    click_link "New Role"
  end

  scenario "with valid attributes" do
    fill_in "Name", with: "Standardtest"
    fill_in "Description", with: "Free. Can only view/update public posts"
    click_button "Create Role"  # "Create Role" was generated by form. Have to run form first to see what it generated
    expect(page).to have_content "Role has been created"

    role = Role.find_by(Name: "Standardtest")
    expect(page.current_url).to eq role_url(role) # make sure this is Show action in role controller
    title = "Wikiiki - Standardtest - Role" # Show.htmp.erb->application_helper.rb->application.html.erb
    expect(page).to have_title title
  end

  scenario "when providing invalid attributes" do
    click_button "Create Role"
    expect(page).to have_content "Role has not been created."
    expect(page).to have_content "Name can't be blank"
  end

  scenario "when providing duplicate name" do
    fill_in "Name", with: "testrole"
    fill_in "Description", with: "testrole description"
    click_button "Create Role"  # "Create Role" was generated by form. Have to run form first to see what it generated
    expect(page).to have_content "Role has been created"

    visit "/roles"
    click_link "New Role"
    fill_in "Name", with: "testrole"
    fill_in "Description", with: "testrole description"
    click_button "Create Role"  # "Create Role" was generated by form. Have to run form first to see what it generated
    expect(page).to have_content("Name has already been taken")
  end

end
